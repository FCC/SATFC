/**
 * Copyright 2015, Auctionomics, Alexandre Fr√©chette, Neil Newman, Kevin Leyton-Brown.
 *
 * This file is part of SATFC.
 *
 * SATFC is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * SATFC is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with SATFC.  If not, see <http://www.gnu.org/licenses/>.
 *
 * For questions, contact us at:
 * afrechet@cs.ubc.ca
 */
package ca.ubc.cs.beta.stationpacking.execution;

import java.io.File;
import java.io.FileNotFoundException;
import java.util.HashMap;
import java.util.HashSet;
import java.util.Map;
import java.util.Set;

import ca.ubc.cs.beta.stationpacking.base.Station;
import ca.ubc.cs.beta.stationpacking.datamanagers.constraints.IConstraintManager;
import ca.ubc.cs.beta.stationpacking.datamanagers.constraints.UnabridgedFormatConstraintManager;
import ca.ubc.cs.beta.stationpacking.datamanagers.stations.DomainStationManager;
import ca.ubc.cs.beta.stationpacking.datamanagers.stations.IStationManager;

/**
 * Test a particular assignment to see if it is feasible.
 * @author afrechet
 */
public class AssignmentTester {

	public static void main(String[] args) {
		
		/**
		 * Read interference data
		 */
		String dataFolder = "/Users/afrechet/Documents/experiments/auction-simulations/InterferenceMay2014/";
		
		
		IStationManager stationManager;
		IConstraintManager constraintsManager;
		try {
			stationManager = new DomainStationManager(dataFolder + File.separator + "domains.csv");
			constraintsManager = new UnabridgedFormatConstraintManager(stationManager, dataFolder + File.separator + "interferences.csv");
		} catch (FileNotFoundException e) {
			e.printStackTrace();
			throw new IllegalArgumentException("Could not load in interference data.");
		}
		
		/**
		 * Read assignment
		 */
		String assignmentString = "87:16,125:0,126:14,131:0,144:20,146:0,147:0,257:24,267:0,269:0,306:30,307:18,308:16,334:27,349:16,361:19,363:0,411:25,412:0,413:29,414:15,415:0,416:22,417:22,418:25,450:19,455:0,591:19,594:29,607:24,608:18,617:30,629:0,664:14,701:21,706:17,710:18,713:0,715:0,720:0,721:22,787:28,993:24,999:14,1002:27,1005:14,1104:30,1136:24,1151:14,1222:0,1255:28,1270:27,2130:29,2325:14,2424:28,2495:26,2506:24,2566:25,2650:29,2708:27,2709:22,2710:0,2711:29,2722:28,2731:23,2739:30,2769:19,2784:28,3032:27,3072:0,3133:0,3167:0,3228:17,3246:24,3359:0,3369:24,3646:0,3658:22,3659:14,3660:27,3661:15,3978:0,4035:0,4108:0,4148:22,4149:23,4152:15,4190:18,4301:0,4326:19,4328:25,4329:0,4351:23,4352:15,4354:19,4366:0,4585:18,4593:26,4624:14,4685:28,4688:0,4689:0,4691:21,4693:0,4939:15,5010:17,5011:26,5243:16,5319:0,5360:25,5468:28,5471:30,5800:18,5801:22,5802:25,5875:0,5906:27,5909:16,5914:24,5982:0,5985:26,6048:0,6093:22,6096:30,6104:20,6124:0,6359:28,6463:25,6476:0,6554:24,6568:22,6601:14,6669:0,6744:23,6823:19,6837:22,6838:30,6864:15,6866:29,6870:24,6885:21,6900:23,7078:0,7143:22,7622:23,7623:0,7651:14,7675:23,7692:22,7700:26,7726:25,7727:30,7780:0,7841:15,7893:19,7908:25,7933:26,8214:0,8241:23,8257:20,8263:18,8309:27,8322:16,8523:26,8532:20,8564:23,8620:27,8653:30,8688:25,8986:24,9015:21,9054:0,9064:0,9375:19,9425:0,9610:25,9614:0,9628:0,9629:28,9630:22,9635:23,9739:0,9754:17,9762:28,9766:0,9781:0,9881:21,9908:0,9913:30,9917:22,9922:0,9939:0,9959:30,9971:24,9987:25,9989:0,9990:0,9999:30,10019:0,10073:30,10132:18,10133:22,10153:21,10177:29,10179:19,10192:29,10195:16,10202:23,10203:25,10205:0,10212:29,10213:29,10221:18,10228:17,10238:0,10242:0,10253:21,10259:0,10265:16,10267:21,10318:28,10498:18,10521:0,10535:30,10536:26,10549:0,10587:17,10758:0,10802:23,10869:17,10894:27,10897:27,10907:21,10981:28,11027:0,11033:24,11034:25,11113:25,11117:16,11118:16,11123:0,11125:30,11204:19,11260:30,11291:18,11371:0,11559:24,11644:26,11699:27,11906:17,11907:24,11908:0,11909:16,11910:17,11911:27,11912:22,11913:26,11951:30,12033:15,12144:19,12171:24,12279:21,12395:15,12427:17,12472:0,12477:28,12497:0,12498:0,12499:0,12520:19,12522:0,12523:24,12524:22,12525:30,12793:29,12855:22,12895:27,12896:0,12913:0,12930:17,13058:28,13060:24,13200:0,13206:28,13456:27,13594:30,13595:0,13602:0,13792:19,13813:27,13924:20,13929:30,13933:24,13938:22,13960:0,13989:0,13991:22,13995:20,14000:0,14040:15,14042:30,14050:20,14302:21,14312:14,14322:0,14326:18,14674:23,14675:14,14682:0,14885:30,15507:0,15567:15,15569:29,16363:26,16455:29,16517:27,16530:15,16539:15,16729:23,16744:18,16747:0,16749:0,16788:0,16817:0,16820:16,16930:0,16940:30,16950:14,16993:0,17012:0,17037:0,17203:28,17320:0,17399:15,17402:15,17433:18,17464:21,17544:16,17611:18,17625:14,17742:25,18083:20,18148:0,18252:30,18267:28,18283:24,18285:18,18286:30,18301:0,18338:23,18732:23,18736:23,18740:28,18741:26,18745:15,18747:28,18753:28,18780:15,18783:0,18793:17,18798:15,18819:27,19183:20,19190:0,19191:21,19199:0,19200:23,19593:14,19654:14,19707:0,19783:0,20015:29,20287:28,20426:27,20476:0,20590:0,20624:23,20818:0,20871:21,21149:24,21150:24,21156:19,21158:23,21245:0,21251:20,21252:24,21253:0,21254:28,21258:20,21259:19,21432:23,21533:0,21536:18,21649:30,21656:19,21726:26,21729:16,21737:16,21801:17,22093:0,22108:19,22121:25,22127:24,22129:27,22161:0,22201:28,22204:23,22206:0,22207:0,22211:29,22215:22,22245:28,22485:0,22589:0,22591:0,22644:20,22819:20,22826:26,23128:21,23142:0,23179:30,23277:28,23302:29,23338:0,23341:22,23394:21,23422:26,23486:23,23487:30,23918:29,23942:30,23960:22,24218:0,24257:14,24314:0,24436:20,24485:0,24508:25,24514:0,24515:23,24518:0,24570:0,24574:20,24582:0,24618:0,24749:16,24753:15,24801:17,24812:19,24813:16,24914:25,24975:26,24976:27,24977:25,24978:0,24981:28,25040:23,25045:0,25065:22,25067:26,25078:20,25173:18,25221:25,25236:0,25358:21,25382:18,25395:24,25396:18,25452:26,25453:0,25454:29,25456:19,25538:28,25544:0,25577:18,25682:27,25683:17,25684:30,25685:27,25686:24,25722:0,25735:0,25932:30,26025:20,26231:18,26249:24,26304:16,26655:14,26950:0,27140:27,27245:19,27290:0,27300:14,27425:27,27431:19,27502:0,27504:21,27621:22,27772:21,27969:28,28010:30,28119:22,28155:16,28199:17,28280:0,28311:16,28324:14,28462:0,28468:26,28476:0,28480:0,28510:0,28926:30,29085:15,29086:16,29096:24,29100:28,29108:23,29114:26,29121:18,29234:30,29292:26,29455:0,29464:25,29547:30,29557:28,29560:23,29706:23,29712:14,29715:0,29719:18,29885:30,30129:0,30244:0,30283:0,30303:0,30576:0,30577:18,30580:0,30601:16,30826:26,30932:25,31351:25,31352:15,31354:24,31368:14,31369:30,31437:14,31570:21,31590:26,31597:28,31870:30,32176:0,32177:0,32179:20,32216:20,32311:22,32326:21,32334:20,32621:18,32851:0,32958:14,33081:23,33261:14,33336:30,33337:17,33440:29,33471:23,33543:27,33658:18,33691:22,33716:22,33722:20,33745:17,33752:29,33764:14,33770:27,33778:0,33819:30,33870:18,33875:22,34167:28,34171:0,34174:22,34177:27,34181:0,34195:26,34196:0,34200:28,34202:0,34204:0,34205:17,34207:27,34211:0,34212:29,34222:29,34329:0,34438:0,34439:17,34440:0,34445:16,34457:0,34459:25,34527:14,34537:15,34564:0,34574:18,34577:25,34846:19,34847:28,34859:19,34867:15,34868:14,35037:30,35084:26,35090:0,35091:21,35095:0,35096:17,35097:30,35101:0,35123:0,35131:26,35134:22,35183:17,35187:28,35189:19,35190:17,35277:19,35283:20,35313:29,35336:29,35380:14,35385:14,35388:20,35396:18,35417:29,35418:24,35419:24,35434:16,35453:23,35460:28,35464:29,35500:24,35512:21,35525:23,35575:0,35576:17,35582:21,35584:16,35585:17,35594:20,35606:21,35608:0,35611:0,35630:22,35648:15,35652:17,35655:14,35663:0,35666:0,35670:24,35692:19,35693:23,35703:25,35705:20,35823:14,35841:19,35843:25,35852:16,35862:0,35867:19,35881:28,35882:25,35883:19,35906:20,35907:24,35908:27,35909:0,35910:30,35911:15,35912:24,35913:24,35918:0,35920:21,35921:0,35923:16,35991:0,35994:25,36003:16,36117:0,36170:22,36395:27,36504:20,36533:26,36607:16,36717:0,36841:30,36846:30,36851:15,36912:17,36916:26,36917:29,36920:21,36989:0,37005:20,37099:29,37101:18,37102:0,37103:21,37104:0,37105:23,37106:21,37174:24,37176:25,37179:0,37238:18,37444:14,37511:19,37689:21,37732:15,37806:29,37808:18,37809:14,37971:0,38336:0,38375:24,38430:0,38497:27,38584:14,38585:17,38586:29,38587:0,38588:17,38590:25,38591:0,39241:29,39270:0,39561:24,39656:29,39664:27,39665:14,39736:18,39738:24,39884:30,40058:0,40211:21,40250:0,40517:18,40618:0,40619:0,40626:0,40758:19,40759:15,40761:0,40820:17,40861:21,40877:16,40902:23,40993:27,41065:24,41070:0,41074:29,41095:0,41126:21,41210:28,41212:16,41221:0,41223:18,41225:27,41230:26,41237:25,41238:21,41314:16,41397:18,41427:18,41436:21,41458:30,41671:0,41674:0,41883:0,41892:19,41969:16,42008:19,42061:25,42121:19,42124:28,42359:30,42636:23,42640:30,42665:0,43095:28,43168:27,43169:23,43176:17,43184:0,43193:18,43197:0,43203:0,43424:0,43649:24,43846:20,43847:0,43870:0,43952:18,44052:25,46728:22,46753:23,46755:0,46979:0,46981:30,47070:19,47401:0,47535:0,47670:20,47705:14,47707:21,47902:28,47903:16,47904:0,47905:19,47906:0,47929:0,47974:25,47975:14,47987:26,47995:21,48013:24,48360:19,48406:0,48408:22,48413:21,48465:28,48477:0,48481:0,48521:21,48525:17,48589:17,48608:29,48660:16,48662:20,48663:0,48666:19,48668:0,48693:15,48772:27,48813:15,48833:29,48834:22,48836:29,48837:29,49134:25,49153:0,49157:17,49235:24,49236:16,49240:29,49264:30,49324:23,49326:21,49330:24,49397:21,49421:22,49439:0,49579:22,49621:16,49632:16,49699:20,49711:0,49712:14,49803:17,49832:17,50044:30,50063:0,50141:0,50147:0,50170:21,50182:19,50198:0,50347:0,50591:26,50780:28,50781:14,50782:16,51101:0,51102:30,51189:30,51207:0,51241:20,51349:21,51429:23,51469:16,51479:19,51488:16,51491:27,51493:15,51499:14,51501:18,51502:25,51517:29,51518:18,51567:14,51568:0,51569:25,51570:14,51597:0,51598:28,51708:25,51806:16,51864:0,51913:27,51930:29,51969:26,51980:0,51984:0,51988:0,51991:18,52075:26,52077:25,52078:0,52240:28,52280:27,52408:0,52420:18,52423:0,52425:28,52426:30,52430:0,52432:0,52579:28,52628:22,52887:0,52888:26,52891:19,52907:20,52953:0,53004:0,53065:23,53114:25,53115:0,53116:15,53117:28,53313:29,53315:20,53320:21,53324:14,53465:0,53517:19,53539:22,53541:16,53544:22,53586:0,53716:21,53734:17,53819:16,53820:24,53843:29,53847:29,53903:18,53905:0,53921:0,53939:14,54011:23,54176:0,54280:17,54414:24,54420:27,54452:0,54728:0,54938:23,54940:20,54963:24,54983:0,55031:15,55049:23,55055:26,55056:17,55083:0,55106:19,55108:27,55203:15,55305:23,55315:15,55350:0,55372:18,55375:27,55379:20,55454:0,55516:0,55528:25,55643:0,55644:0,55683:25,55684:24,55762:28,55907:19,56028:16,56029:19,56032:23,56033:22,56034:19,56079:23,56092:0,56384:0,56523:0,56524:28,56526:24,56527:21,56528:27,56548:0,56549:0,56550:0,56852:25,56971:14,57219:17,57220:19,57221:25,57274:0,57292:0,57431:0,57457:18,57476:14,57538:22,57545:14,57548:25,57832:23,57837:0,57840:0,57884:27,57907:27,57908:28,57945:0,58261:30,58262:0,58267:22,58408:23,58560:15,58605:15,58609:18,58616:16,58618:14,58684:24,58725:20,58739:21,58795:0,58827:0,58835:19,58912:27,58927:0,58978:0,59013:24,59014:26,59255:24,59257:14,59280:14,59438:15,59440:15,59441:15,59442:24,59444:25,59494:15,59500:18,59852:0,59988:28,60018:26,60026:27,60165:19,60353:25,60354:19,60384:0,60464:17,60534:0,60536:0,60537:26,60539:22,60549:29,60551:30,60552:27,60553:0,60555:27,60556:30,60559:28,60560:0,60637:22,60639:17,60653:18,60654:28,60675:21,60728:23,60740:26,60820:21,60825:0,60827:26,60829:26,60830:22,60888:0,60931:0,61003:29,61007:30,61008:0,61009:0,61011:0,61012:14,61013:0,61026:18,61039:30,61064:23,61068:30,61072:29,61084:16,61111:0,61173:24,61214:0,61216:0,61217:0,61251:23,61335:16,61504:26,61551:17,61702:0,61961:22,62009:14,62136:0,62137:23,62182:15,62207:14,62219:16,62293:19,62354:0,62388:22,62424:26,62427:23,62430:19,62442:19,62468:16,62469:0,63046:16,63153:22,63154:23,63158:27,63164:24,63165:26,63166:21,63177:26,63182:17,63329:0,63557:19,63768:14,63865:0,63867:28,63901:24,63927:0,64017:16,64033:17,64048:26,64338:0,64352:15,64400:0,64444:28,64545:16,64547:16,64548:25,64549:21,64550:0,64588:17,64611:18,64690:0,64833:0,64877:20,64969:15,64971:26,64974:30,64984:15,64987:0,65074:0,65128:0,65130:24,65143:22,65204:17,65247:19,65355:16,65370:17,65387:26,65395:21,65523:25,65526:0,65528:19,65666:20,65667:0,65670:0,65680:0,65681:21,65684:20,65686:15,65690:29,65749:0,65758:0,65919:24,65942:28,65943:0,65944:0,66170:26,66174:14,66185:21,66190:0,66219:15,66222:26,66285:0,66321:0,66358:20,66378:0,66402:23,66413:25,66469:21,66536:29,66636:30,66781:0,66790:0,66804:15,66807:28,66908:21,66978:0,66983:20,66996:0,67000:26,67001:14,67002:21,67013:21,67020:26,67022:0,67077:16,67089:17,67335:20,67347:15,67485:17,67602:29,67760:16,67766:20,67781:27,67784:23,67786:16,67792:0,67798:0,67866:17,67868:17,67869:17,67884:0,67893:23,67895:23,67910:22,67950:21,67971:24,67993:0,67999:23,68007:0,68058:19,68135:29,68136:30,68137:26,68393:17,68394:0,68395:0,68396:0,68400:0,68401:0,68403:20,68405:0,68407:19,68408:0,68409:0,68427:0,68433:17,68444:19,68518:23,68519:29,68538:29,68542:21,68545:0,68547:28,68549:17,68581:20,68594:29,68597:14,68666:29,68695:23,68717:29,68753:15,68834:20,68886:26,68889:15,68905:20,68910:26,68911:19,69080:20,69114:0,69124:19,69149:0,69271:0,69273:28,69292:19,69300:20,69328:25,69332:26,69338:15,69360:0,69396:20,69397:0,69416:0,69440:0,69444:14,69446:26,69447:16,69479:0,69531:22,69532:15,69544:0,69571:0,69582:17,69618:26,69619:29,69692:0,69693:15,69733:30,69735:0,69940:20,69943:0,69944:0,70021:18,70034:27,70097:0,70119:0,70138:27,70149:16,70158:22,70161:28,70184:0,70251:0,70309:29,70416:26,70419:30,70420:19,70429:0,70482:21,70491:24,70492:24,70493:0,70536:20,70537:18,70578:17,70649:21,70651:0,70689:21,70699:0,70852:22,70865:30,70900:30,70917:0,71023:28,71069:24,71072:29,71074:17,71078:25,71079:19,71080:15,71082:19,71085:0,71089:0,71111:0,71119:21,71121:17,71125:15,71127:14,71130:23,71217:0,71218:0,71221:24,71236:22,71238:30,71278:0,71280:30,71293:19,71297:16,71325:30,71326:30,71329:0,71353:0,71357:25,71363:25,71422:17,71427:0,71428:26,71508:0,71558:30,71561:16,71580:27,71586:0,71645:27,71657:27,71676:0,71861:0,71871:22,71905:0,71928:0,71948:18,72041:23,72052:0,72060:0,72062:0,72064:30,72076:0,72096:0,72098:0,72099:24,72106:0,72115:24,72119:14,72120:14,72123:0,72145:26,72207:26,72278:27,72300:18,72307:19,72313:0,72335:25,72342:0,72358:18,72359:29,72618:29,72623:26,72871:28,72945:0,72958:0,72971:17,73036:25,73042:21,73083:0,73101:0,73107:0,73113:22,73120:25,73136:29,73152:22,73153:26,73155:28,73187:30,73188:30,73189:19,73195:17,73203:0,73205:17,73206:21,73207:0,73226:25,73230:22,73238:0,73255:29,73263:21,73264:0,73310:28,73312:0,73318:0,73319:25,73333:0,73344:0,73354:0,73356:0,73374:27,73375:0,73642:23,73701:14,73706:0,73764:24,73875:0,73879:17,73905:0,73907:27,73910:0,73964:0,73982:23,73983:0,73998:15,73999:26,74007:0,74034:23,74070:28,74091:22,74094:0,74098:0,74112:18,74137:18,74138:18,74151:25,74156:29,74170:0,74174:0,74176:25,74192:15,74197:24,74211:30,74214:22,74215:26,74216:25,74256:22,74416:20,74417:26,74419:0,74420:0,74422:26,74464:0,74559:25,76268:15,77063:20,77451:16,77452:29,77480:28,77483:26,77512:25,77515:20,77676:19,77677:24,77678:0,77719:24,77789:18,78036:30,78314:25,78322:22,78908:0,78910:22,78915:22,78921:28,79258:30,81441:0,81445:19,81447:29,81448:28,81451:18,81458:19,81464:27,81507:24,81508:23,81509:14,81593:26,81594:27,81595:0,81669:0,81692:21,81694:30,81750:25,82476:21,82576:30,82585:14,82611:21,82613:15,82615:16,82619:16,82627:0,82735:19,82910:15,83180:22,83181:17,83306:24,83707:26,83714:28,83715:22,83740:16,83822:24,83825:30,83913:0,83929:17,83943:14,83945:24,83946:16,83969:30,84088:15,84157:20,84214:30,84224:25,84225:15,84253:26,84410:24,84453:30,84802:28,86204:14,86208:14,86263:14,86496:29,86532:25,86534:26,89714:18,125710:30,132606:15,136749:18,136750:30,159007:19,162016:17,162115:22,166319:27,166331:29,166332:15,166510:22,166511:15,166512:16,166534:14,167158:21,167309:26,167324:23,167543:24,167588:14,167796:17,167797:23,167799:24,167820:27,167838:21,167841:0,167842:0,167844:28,167892:19,167948:30,168014:20,168090:20,168093:30,168095:26,168101:30,168154:30,168219:0,168237:0,168239:21,168287:18,168332:21,168338:23,168339:19,168404:29,168406:27,168414:0,168419:0,168449:23,168452:14,168471:20,168478:21,168495:23,168560:24,168561:18,168662:30,168750:25,168800:25,168812:16,168834:0,169027:16,169028:15,169030:30,189058:0,189735:20,189843:19,189851:22,189855:14,189857:20,189858:16,189859:28,189860:27,189983:29,190087:0,190120:23,190156:16,190204:26,190915:14,191101:22,191262:0,191318:20,191340:0,191793:0,191822:26,192499:0,192867:0,197767:24";
		
		Map<Integer,Set<Station>> assignment = new HashMap<Integer,Set<Station>>();
		for(String stationChannel : assignmentString.split(","))
		{
			int stationID = Integer.valueOf(stationChannel.split(":")[0]);
			Station station = stationManager.getStationfromID(stationID);
					
			Integer channel = Integer.valueOf(stationChannel.split(":")[1]);
			
			if(channel != 0)
			{
				if(!assignment.keySet().contains(channel))
				{
					assignment.put(channel, new HashSet<Station>());
				}
				assignment.get(channel).add(station);
			}
		}
		
		/**
		 * Test assignment;
		 */
		boolean indomains = true;
		for(Integer channel :  assignment.keySet())
		{
			for(Station station : assignment.get(channel))
			{
				if(!stationManager.getDomain(station).contains(channel))
				{
					System.out.println("Channel "+channel+" is not in station "+station+"'s domain ("+stationManager.getDomain(station)+").");
					indomains = false;
					break;
				}
			}
			if(!indomains)
			{
				break;
			}
		}
		boolean noninterfering = constraintsManager.isSatisfyingAssignment(assignment);
		
		System.out.println("In all domains: "+indomains);
		System.out.println("Non-interfering: "+noninterfering);
		
		

	}

}
