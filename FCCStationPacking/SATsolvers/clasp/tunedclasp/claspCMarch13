#!/usr/bin/env python
import subprocess
import sys
import platform
from sys import platform as _platform

claspx32_path = 'clasp/claspx32/build/release/bin/clasp'
claspx64_path = 'clasp/claspx64/build/release/bin/clasp'
claspx64osx_path = 'clasp/claspx64osx/build/release/bin/clasp'

(bits,linkage) = platform.architecture()
if '32' in bits:
    clasp_path = claspx32_path
elif '64' in bits:
    if _platform == "linux" or _platform == "linux2":
        clasp_path = claspx64_path
    elif _platform == "darwin":
        clasp_path = claspx64osx_path
else:
    raise Exception('UNRECOGNIZED ARCHITECTURE IN SETTING SOLVER PATH!')

CNF = sys.argv[1]

#No cutoff is handed to TunedClasp for now as RunSolver takes care of cutting off.
cutoff = str(604800)


#clasp_path = "../"+clasp_path
#cmd = "cd wrappers; python clasp_wrapper.py 0 "+CNF+" 0 "+cutoff+" 2147483647 6124278 -@0:F:backprop 'no' -@0:S:eqCond 'no' -@0:S:sat-prepro 'no' -@0:no:eq '0' -@0:sat-prepro '0' -@0:solver '"+clasp_path+"' -@0:trans-ext 'all' -@1:0:deletion '3' -@1:0:restarts 'L' -@1:0:restarts:del-cfl 'F' -@1:1:Simp:restarts '256' -@1:1:del-algo 'basic' -@1:1:del-glue '4' -@1:1:del-grow '1.0' -@1:1:del-init-r '800' -@1:1:del-on-restart '50' -@1:1:deletion '66' -@1:1:lookahead 'no' -@1:1:restarts:del-cfl '100' -@1:1:strengthen 'local' -@1:2:del-algo '0' -@1:2:del-glue '0' -@1:2:del-grow '100.0' -@1:2:del-init-r '20000' -@1:2:deletion '3.0' -@1:2:strengthen '1' -@1:3:restarts:del-grow 'F' -@1:4:restarts:del-grow '128' -@1:F:berk-huang 'yes' -@1:F:berk-once 'no' -@1:F:del-estimate 'no' -@1:F:init-moms 'no' -@1:F:local-restarts 'yes' -@1:F:sign-fix 'no' -@1:F:update-act 'yes' -@1:S:Luby:aryrestarts '1' -@1:S:contraction 'yes' -@1:S:counterCond 'yes' -@1:S:del-initCond 'yes' -@1:berk-max '256' -@1:contraction '120' -@1:counter-bump '180' -@1:counter-restarts '3' -@1:del-max '10000' -@1:heuristic 'Berkmin' -@1:init-watches '0' -@1:loops 'no' -@1:otfs '0' -@1:reverse-arcs '3' -@1:save-progress '10' -@1:sign-def '2' -@1:update-lbd '2'" 


#Ripped out the call string from clasp wrapper to avoid having to run runsolver. Might want to use run solver for a linux version.
cmd = clasp_path+" --outf 0 "+CNF+" --eq=0 --trans-ext=all --sat-prepro=0 --sign-def=2 --del-max=10000 --strengthen=local,1 --del-init-r=800,20000 --loops=no --init-watches=0 --heuristic=Berkmin --del-cfl=F,100 --restarts=L,256 --del-algo=basic,0 --deletion=3,66,3.0 --berk-max=256 --del-grow=1.0,100.0,F,128 --update-act --del-glue=4,0 --update-lbd=2 --reverse-arcs=3 --otfs=0 --berk-huang --del-on-restart=50 --contraction=120 --counter-restarts=3 --local-restarts --lookahead=no --save-progress=10 --counter-bump=180"
subprocess.call(cmd,shell=True)

